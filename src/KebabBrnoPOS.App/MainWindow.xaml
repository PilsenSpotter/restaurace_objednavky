<Window x:Class="KebabBrnoPOS.App.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:KebabBrnoPOS.App"
        mc:Ignorable="d"
        Title="Kebab Brno - Obsluha"
        Height="800"
        Width="1200"
        Background="#0f172a"
        WindowStartupLocation="CenterScreen">
    <Window.Resources>
        <local:BooleanToAddTextConverter x:Key="BooleanToAddTextConverter" />
        <local:AvailabilityBrushConverter x:Key="AvailabilityBrushConverter" />
    </Window.Resources>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <Border Background="#111827" Padding="16" BorderBrush="#1f2937" BorderThickness="0 0 0 1">
            <Grid VerticalAlignment="Center">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="Kebab Brno · Obsluha"
                               FontSize="22"
                               FontWeight="SemiBold"
                               Foreground="White" />
                    <TextBlock Text="{Binding LowStockInfo}"
                               Foreground="#f59e0b"
                               FontWeight="SemiBold"
                               VerticalAlignment="Center"
                               Margin="12,0,0,0" />
                </StackPanel>

                <StackPanel Grid.Column="1" Orientation="Vertical" HorizontalAlignment="Right" Margin="0,0,16,0">
                    <TextBlock Text="Denní tržba" Foreground="#9ca3af" FontSize="12" />
                    <TextBlock Text="{Binding Store.DenniTrzba, StringFormat={}{0:C}}"
                               Foreground="White"
                               FontSize="18"
                               FontWeight="Bold" />
                </StackPanel>

                <StackPanel Grid.Column="2" Orientation="Horizontal" HorizontalAlignment="Right">
                    <Button Content="Kuchyňský displej"
                            Click="OpenKitchenDisplay_Click"
                            Padding="12,6"
                            Background="#2563eb"
                            Foreground="White"
                            BorderBrush="#1d4ed8"
                            FontWeight="SemiBold" />
                    <Button Content="Doplnit sklad +10"
                            Click="Restock_Click"
                            Padding="12,6"
                            Background="#374151"
                            Foreground="White"
                            BorderBrush="#4b5563"
                            Margin="8,0,0,0" />
                </StackPanel>
            </Grid>
        </Border>

        <Grid Grid.Row="1" Background="#0f172a">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="2*" />
                <ColumnDefinition Width="2.4*" />
                <ColumnDefinition Width="1.4*" />
            </Grid.ColumnDefinitions>

            <!-- MENU -->
            <Border Grid.Column="0" Padding="16" BorderBrush="#1f2937" BorderThickness="0 0 1 0">
                <DockPanel LastChildFill="True">
                    <StackPanel Orientation="Horizontal" DockPanel.Dock="Top" Margin="0,0,0,12">
                        <TextBlock Text="Menu" Foreground="White" FontSize="18" FontWeight="SemiBold" />
                        <ComboBox ItemsSource="{Binding Categories}"
                                  SelectedItem="{Binding SelectedCategory}"
                                  Width="140"
                                  Background="#111827"
                                  Foreground="White"
                                  BorderBrush="#1f2937"
                                  Margin="12,0,0,0" />
                    </StackPanel>
                    <ScrollViewer>
                        <ItemsControl ItemsSource="{Binding MenuView}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Border Margin="0 0 0 10" Padding="12" Background="#111827" CornerRadius="8" BorderBrush="#1f2937" BorderThickness="1">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*" />
                                                <ColumnDefinition Width="Auto" />
                                            </Grid.ColumnDefinitions>

                                            <StackPanel>
                                                <TextBlock Text="{Binding Name}" Foreground="White" FontSize="16" FontWeight="SemiBold" />
                                                <TextBlock Text="{Binding Description}" Foreground="#9ca3af" FontSize="12" />
                                                <StackPanel Orientation="Horizontal" Margin="0,6,0,0">
                                                    <TextBlock Text="{Binding Category}" Foreground="#6b7280" FontSize="12" />
                                                    <TextBlock Text="{Binding Price, StringFormat={}{0:C}}"
                                                               Foreground="#10b981"
                                                               FontWeight="Bold"
                                                               FontSize="14"
                                                               Margin="10,0,0,0" />
                                                    <TextBlock Text="{Binding Stock, StringFormat={}{0} ks}"
                                                               Foreground="#9ca3af"
                                                               FontSize="12"
                                                               Margin="10,0,0,0" />
                                                </StackPanel>
                                            </StackPanel>

                                            <Button Grid.Column="1"
                                                    VerticalAlignment="Center"
                                                    Content="{Binding IsAvailable, Converter={StaticResource BooleanToAddTextConverter}}"
                                                    Tag="{Binding}"
                                                    Click="AddItem_Click"
                                                    Padding="12,8"
                                                    Background="{Binding IsAvailable, Converter={StaticResource AvailabilityBrushConverter}}"
                                                    Foreground="White"
                                                    BorderBrush="#1f2937"
                                                    FontWeight="SemiBold"
                                                    IsEnabled="{Binding IsAvailable}" />
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </ScrollViewer>
                </DockPanel>
            </Border>

            <!-- ORDER -->
            <Border Grid.Column="1" Padding="16" BorderBrush="#1f2937" BorderThickness="0 0 1 0">
                <DockPanel LastChildFill="True">
                    <TextBlock DockPanel.Dock="Top" Text="Objednávka" Foreground="White" FontSize="18" FontWeight="SemiBold" Margin="0,0,0,12" />
                    <StackPanel>
                        <ItemsControl ItemsSource="{Binding AktivniObjednavka.Items}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Border Margin="0 0 0 10" Padding="12" Background="#111827" CornerRadius="8" BorderBrush="#1f2937" BorderThickness="1">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*" />
                                                <ColumnDefinition Width="Auto" />
                                            </Grid.ColumnDefinitions>
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height="Auto" />
                                                <RowDefinition Height="Auto" />
                                            </Grid.RowDefinitions>

                                            <StackPanel>
                                                <TextBlock Text="{Binding Item.Name}" Foreground="White" FontSize="15" FontWeight="SemiBold" />
                                                <StackPanel Orientation="Horizontal" Margin="0,4,0,0">
                                                    <TextBlock Text="Varianta:" Foreground="#9ca3af" FontSize="12" />
                                                    <ComboBox ItemsSource="{Binding Item.Options}"
                                                              SelectedItem="{Binding SelectedOption, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                              Width="140"
                                                              Background="#0b1220"
                                                              Foreground="White"
                                                              BorderBrush="#1f2937"
                                                              FontSize="12"
                                                              Margin="8,0,0,0" />
                                                </StackPanel>
                                            </StackPanel>

                                            <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
                                                <Button Content="−" Tag="{Binding}" Click="DecreaseQuantity_Click"
                                                        Background="#1f2937" Foreground="White" Padding="8,4" BorderBrush="#1f2937" />
                                                <TextBlock Text="{Binding Quantity}" Foreground="White" FontSize="14" FontWeight="SemiBold" VerticalAlignment="Center" Margin="6,0" />
                                                <Button Content="+" Tag="{Binding}" Click="IncreaseQuantity_Click"
                                                        Background="#1f2937" Foreground="White" Padding="8,4" BorderBrush="#1f2937" />
                                                <Button Content="✕" Tag="{Binding}" Click="RemoveItem_Click"
                                                        Background="#b91c1c" Foreground="White" Padding="8,4" BorderBrush="#7f1d1d" Margin="6,0,0,0" />
                                            </StackPanel>

                                            <StackPanel Grid.Row="1" Grid.ColumnSpan="2" Orientation="Horizontal" Margin="0,8,0,0">
                                                <TextBlock Text="Cena:" Foreground="#9ca3af" FontSize="12" />
                                                <TextBlock Text="{Binding Total, StringFormat={}{0:C}}" Foreground="#10b981" FontWeight="SemiBold" Margin="8,0,0,0" />
                                            </StackPanel>
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                            <ItemsControl.Template>
                                <ControlTemplate TargetType="ItemsControl">
                                    <ScrollViewer CanContentScroll="True">
                                        <ItemsPresenter />
                                    </ScrollViewer>
                                </ControlTemplate>
                            </ItemsControl.Template>
                        </ItemsControl>

                        <StackPanel Margin="0,12,0,0">
                            <TextBlock Text="Poznámka k objednávce" Foreground="#9ca3af" FontSize="12" />
                            <TextBox Text="{Binding AktivniObjednavka.Note, UpdateSourceTrigger=PropertyChanged}" 
                                     Background="#0b1220"
                                     Foreground="White"
                                     BorderBrush="#1f2937"
                                     Margin="0,4,0,0"
                                     Height="60"
                                     TextWrapping="Wrap" />
                        </StackPanel>
                    </StackPanel>
                </DockPanel>
            </Border>

            <!-- SUMMARY -->
            <Border Grid.Column="2" Padding="16">
                <StackPanel>
                    <TextBlock Text="Souhrn" Foreground="White" FontSize="18" FontWeight="SemiBold" />
                    <Border Background="#111827" Padding="12" CornerRadius="8" BorderBrush="#1f2937" BorderThickness="1" Margin="0,8,0,0">
                        <StackPanel>
                            <TextBlock Text="Celkem"
                                       Foreground="#9ca3af"
                                       FontSize="12" />
                            <TextBlock Text="{Binding AktivniObjednavka.Total, StringFormat={}{0:C}}"
                                       Foreground="#10b981"
                                       FontSize="28"
                                       FontWeight="Bold" />
                        </StackPanel>
                    </Border>
                    <StackPanel Margin="0,10,0,0">
                        <Button Content="Odeslat do kuchyně"
                                Click="SubmitOrder_Click"
                                Padding="14,10"
                                Background="#22c55e"
                                Foreground="White"
                                FontWeight="SemiBold"
                                BorderBrush="#16a34a" />
                        <Button Content="Tisk účtenky"
                                Click="PrintReceipt_Click"
                                Padding="12,8"
                                Background="#2563eb"
                                Foreground="White"
                                FontWeight="SemiBold"
                                BorderBrush="#1d4ed8"
                                Margin="0,8,0,0" />
                        <Button Content="Vymazat objednávku"
                                Click="ResetOrder_Click"
                                Padding="12,8"
                                Background="#374151"
                                Foreground="White"
                                BorderBrush="#4b5563"
                                Margin="0,8,0,0" />
                    </StackPanel>
                    <Border Background="#0b1220" Padding="12" CornerRadius="8" BorderBrush="#1f2937" BorderThickness="1" Margin="0,12,0,0">
                        <StackPanel>
                            <TextBlock Text="Otevřené objednávky" Foreground="#9ca3af" FontSize="12" />
                            <ItemsControl ItemsSource="{Binding Store.Orders}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Border Margin="0 6 0 0" Padding="8" Background="#111827" CornerRadius="6" BorderBrush="#1f2937" BorderThickness="1">
                                            <StackPanel>
                                                <TextBlock Text="{Binding DisplayCode}" Foreground="White" FontWeight="SemiBold" />
                                                <TextBlock Text="{Binding Status}" Foreground="#9ca3af" FontSize="12" />
                                                <TextBlock Text="{Binding Total, StringFormat={}{0:C}}" Foreground="#10b981" />
                                            </StackPanel>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </StackPanel>
                    </Border>
                </StackPanel>
            </Border>
        </Grid>
    </Grid>
</Window>
